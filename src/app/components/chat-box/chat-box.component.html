<mat-card class="chat-box" clickOutside>
  <div class="messages" #messageContainer>
    <div *ngFor="let msg of messages" class="chat-bubble" [ngClass]="msg.sender">
      <span>{{ msg.content }}</span>

      <div *ngIf="msg.agent === 'task' && msg.context">
        <small class="context-info">
          Task: {{ msg.context.name }}<br>
          Repeat: {{ msg.context.repeat ? 'Yes' : 'No' }}
        </small>
      </div>
    </div>
  </div>

  <!-- Dynamic input for missing task fields -->
  <div *ngIf="lastTaskContext as ctx">
    <div *ngIf="ctx.interval === null">
      <mat-form-field appearance="outline" class="input-field">
        <input matInput placeholder="Enter interval (e.g. every 2 hours)" [(ngModel)]="intervalInput" />
      </mat-form-field>
    </div>

    <div *ngIf="ctx.message === null">
      <mat-form-field appearance="outline" class="input-field">
        <input matInput placeholder="Reminder message" [(ngModel)]="messageInput" />
      </mat-form-field>
    </div>

    <button mat-raised-button color="primary" (click)="submitMissingValues()">Submit</button>
  </div>

  <div class="input-area">
    <mat-form-field appearance="outline" class="input-field">
      <input matInput [(ngModel)]="userInput" placeholder="Type a message..." (keydown.enter)="sendMessage()" />
    </mat-form-field>
    <button mat-icon-button color="primary" (click)="sendMessage()">
      <mat-icon>send</mat-icon>
    </button>
  </div>
</mat-card>
